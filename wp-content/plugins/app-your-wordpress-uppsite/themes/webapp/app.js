/*a68a2c52c15bd8dd1bf717aa31021bf35bd52691*/Ext.define("UppSite.model.LinkList",{extend:"Ext.data.Model",config:{fields:["permalink","title"]}});Ext.define("UppSite.view.Search.SearchBar",{extend:"Ext.Toolbar",xtype:"searchbar",requires:["Ext.field.Text","Ext.field.Search"],config:{layout:"vbox",cls:"big",items:[{xtype:"searchfield",placeHolder:"Search...",flex:1,align:"center",cls:"search-bar",listeners:{action:function(a){this.up("searchpanel").search(a.getValue())}}}]}});if(typeof(FlurryAgent)=="undefined"){FlurryAgent={};FlurryAgent.startSession=function(){};FlurryAgent.setAppVersion=function(){};FlurryAgent.logEvent=function(){};FlurryAgent.endTimedEvent=function(){}}FlurryAgent.startSession(UPPSITE_ANALYTICS_KEY);FlurryAgent.setAppVersion(UPPSITE_PLUGIN_VERSION);Ext.define("UppSite.helper.Analytics",{logTabChange:function(b){var a=new Object();a.tab_name=b;FlurryAgent.logEvent("changed_tab",a)},logLogin:function(b){var a=new Object();a.username=b;FlurryAgent.logEvent("user_login",a)},logComment:function(a,c){var b=new Object();b.comment_type=a;b.url=c;FlurryAgent.logEvent("new_comment",b)},logShare:function(b,d,a){var c=new Object();c.share_type=b;c.url=d;c.was_successful=a;FlurryAgent.logEvent("share_post",c)},logNewPost:function(b,a){var c=new Object();c.post_id=b;c.was_successful=a;FlurryAgent.logEvent("new_post",c)},logSearch:function(b){var a=new Object();a.query=b;FlurryAgent.logEvent("search_query",a)},logExternalLink:function(a){var b=new Object();b.link_type="external";b.external_links=a;FlurryAgent.logEvent("external_link",b)},logAdsClick:function(a,b){var c=new Object();c.type=a;c.url=b;FlurryAgent.logEvent("ads_clicked",c)},startPageEnter:function(a){var b=new Object();b.url=a;FlurryAgent.endTimedEvent("page_enter");FlurryAgent.logEvent("page_enter",b,true)}});Analytics=Ext.create("UppSite.helper.Analytics");Ext.define("UppSite.view.post.ExcerptList",{extend:"Ext.List",xtype:"excerptlist",requires:["Ext.plugin.ListPaging","Ext.plugin.PullRefresh"],initialize:function(){var a=Ext.data.StoreManager.lookup("postsStore");a.initWithViewParams("excerpt");a.load();this.setStore(a);this.callParent()},config:{ui:"round",cls:"x-posts-excerpt",allowDeselect:true,itemTpl:new Ext.XTemplate('<header class="entry-header">','<tpl if="thumb_url"><div class="alignleft listview-post-thumbnail" style="background-image: url({thumb_url})"></div></tpl>','<h1 class="entry-title">{title}</h1>','<div class="info"><span class="time">{time}</span> | <span class="author">{member.name}</span></div>',"</header>",'<div class="entry-summary">','<p class="ui-li-desc">{excerpt}</p>',"</div>","<footer>",'<span class="comments-num">{comments_num} Comments</span><span class="empty">&nbsp;</span><span class="read-more">Read More &gt;</span>',"</footer>"),plugins:[{xclass:"Ext.plugin.ListPaging",cls:"x-load-more",autoPaging:true},{xclass:"Ext.plugin.PullRefresh"}],show:function(){UppSite.model.LocalStorge.currentPermalink=UppSite.model.BlogInfo.title;UppSite.model.LocalStorge.currentTitle=UppSite.model.BlogInfo.permalink},listeners:{painted:function(){Analytics.startPageEnter("homepage")}}}});Ext.define("UppSite.view.CreateComment",{extend:"Ext.form.Panel",xtype:"create-comment",requires:["Ext.form.FieldSet","Ext.form.Email","Ext.form.Url"],initialize:function(){if(UppSite.model.User.isUserLogged()){this.down("#usernamefield").setReadOnly(true);this.down("#usernamefield").setValue(UppSite.model.User.username);this.down("#emailfield").hide();this.down("#urlfield").hide()}else{this.down("#usernamefield").setReadOnly(false);this.down("#emailfield").show();this.down("#urlfield").show()}this.callParent()},config:{id:"createCommentView",currentNavigation:"",items:[{xtype:"toolbar",ui:"light",docked:"top",layout:{pack:"start"},title:"Comment",items:[{xtype:"button",text:"Cancel",align:"left",handler:function(){this.parent.parent.getCurrentNavigation().getNavigationBar().show();this.parent.parent.getCurrentNavigation().pop()}},{xtype:"spacer"},{xtype:"button",text:"Post",align:"right",handler:function(){var a=Ext.ComponentQuery.query("#content_fullpostview")[0];var b=Ext.ComponentQuery.query("#post_id_hidden")[0];b.setValue(a.getData().id);this.up("create-comment").submit({url:"wp-comments-post.php?uppsite_request=1",method:"POST",success:function(d,c){Ext.Msg.alert("Post succeeded!");this.refreshPost();this.popToPost();Analytics.logComment("wp_comment",document.getElementById("post_permalink").value)},failure:function(d,c){Ext.Msg.alert("Post succeeded!");this.refreshPost();this.popToPost();Analytics.logComment("wp_comment",document.getElementById("post_permalink").value)}})}}]},{xtype:"fieldset",items:[{xtype:"textfield",name:"author",label:"Name",id:"usernamefield",placeHolder:"Required"},{xtype:"emailfield",name:"email",label:"Email",id:"emailfield",placeHolder:"Required"},{xtype:"urlfield",name:"url",label:"Website",id:"urlfield"},{xtype:"textareafield",name:"comment",maxRows:6,placeHolder:"Enter your comment"},{id:"post_id_hidden",xtype:"hiddenfield",name:"comment_post_ID",value:0},{xtype:"hiddenfield",name:"submit",value:"Post Comment"}]}],listeners:{painted:function(){Analytics.startPageEnter("create-comment")}}},refreshPost:function(){var a=Ext.ComponentQuery.query("#fullpostview")[0];a.updateRecord(a.getRecord())},popToPost:function(){this.getCurrentNavigation().getNavigationBar().show();this.getCurrentNavigation().pop()}});Ext.define("UppSite.view.AdsPanel",{extend:"Ext.Panel",xtype:"adspanel",requires:[],config:{cls:"ads-panel",autoDestroy:false,layout:"fit",docked:"top",autoLoad:true,html:"",listeners:{painted:function(){if(UPPSITE_ADS==""){return}if(UPPSITE_ADS.matomy_site_id!=undefined){UppSiteAdRequest(UPPSITE_ADS.matomy_site_id,UPPSITE_ADS.matomy_zone_id,this)}else{this.setHtml(UPPSITE_ADS.html)}},tap:{element:"element",fn:function(b){var a=b.target.parentNode.href;Analytics.logAdsClick(a,((a.indexOf("matomy")!=-1)?"matomy":"webView"))}}}}});Ext.define("UppSite.view.linklist.LinkList",{extend:"Ext.List",xtype:"linklist",initialize:function(){var a=Ext.create(this.config.storeClass);a.load();this.setStore(a);this.callParent()},config:{storeClass:"UppSite.store.LinkList",ui:"round",layout:"vbox",allowDeselect:true,cls:"linkList",items:[{xtype:"adspanel",flex:1}],itemTpl:['<span class="title">{title}</span>'].join(""),listeners:{show:function(){this.parent.down("#actionButton").hide()},load:function(){if(this.getStore().getData().length==0){var a=Ext.create("UppSite.view.NoContentPanel");this.add(a)}}},title:UPPSITE_BLOG_NAME}});Ext.define("UppSite.model.BlogInfo",{statics:{title:null,permalink:null},constructor:function(a){this.initConfig(a);Ext.Ajax.request({url:"?uppsite_request=bloginfo",success:function(b){try{var c=JSON.parse(b.responseText);UppSite.model.BlogInfo.title=c.name;UppSite.model.BlogInfo.permalink=c.url}catch(d){}}});return this},alias:"model.BlogInfo"});Ext.define("UppSite.store.LinkList",{extend:"Ext.data.Store",config:{model:"UppSite.model.LinkList",autoLoad:true,proxy:{type:"ajax",url:"?uppsite_request=index",pageParam:"paged"}}});Ext.define("UppSite.view.actionsheet.FacebookShare",{extend:"Ext.Panel",xtype:"facebookshare",config:{scrollable:true,items:[{},{xtype:"panel",html:'<iframe allowtransparency="true" frameborder="0" scrolling="no" src="//platform.twitter.com/widgets/tweet_button.html" style="width:130px; height:20px;"></iframe>'}]}});Ext.define("UppSite.store.Categories",{extend:"UppSite.store.LinkList",config:{proxy:{url:"?uppsite_request=categories"}}});Ext.define("UppSite.view.linklist.CategoriesList",{extend:"UppSite.view.linklist.LinkList",xtype:"categorieslist",requires:["UppSite.store.Categories"],config:{title:UPPSITE_BLOG_NAME,ui:"round",cls:"x-cats linkList",storeClass:"UppSite.store.Categories",listeners:{painted:function(){Analytics.startPageEnter("categories")}}}});Ext.define("UppSite.view.actionsheet.ActionSheet",{extend:"Ext.ActionSheet",xtype:"actionsheet",requires:["UppSite.view.actionsheet.FacebookShare"],config:{id:"menu_actionsheet",hidden:true,items:[{id:"actionsheet_comment_button",text:"Comment",hidden:true,handler:function(){this.parent.hide();var a=Ext.create("UppSite.view.CreateComment");var b=Ext.ComponentQuery.query("#fullpostview")[0].up("navigationview");a.setCurrentNavigation(b);b.getNavigationBar().hide();b.push(a)}},{text:"Share Facebook",id:"actionsheet_facebook_button",handler:function(){var a=this.parent.getCurrentPostData();var b="http://www.facebook.com/sharer.php?u="+a.permalink+"&t="+a.title;window.open(b,"Facebook","menubar=no,width=430,height=360,toolbar=no");this.parent.hide();Analytics.logShare("facebook",a.permalink,true)}},{text:"Share Email",handler:function(){var a=this.parent.getCurrentPostData();var b="mailto:?body=Hi, I wanted to share this with you:"+a.permalink+" .This was shared via UppSite&subject="+a.title;window.location=b;this.parent.hide();Analytics.logShare("email",a.permalink,true)}},{text:"Share Twitter",handler:function(){var a=this.parent.getCurrentPostData();var b="http://twitter.com/share?url="+a.permalink+"&text="+a.title;window.open(b,"Twitter","menubar=no,width=430,height=360,toolbar=no");this.parent.hide();Analytics.logShare("twitter",a.permalink,true)}},{text:"Cancel",ui:"decline",handler:function(){this.parent.hide()}}],listeners:{}},getCurrentPostData:function(){var c;var b;if(UppSite.model.LocalStorge.currentPermalink!=null){c=encodeURIComponent(UppSite.model.LocalStorge.currentTitle);b=encodeURIComponent(UppSite.model.LocalStorge.currentPermalink)}else{c=UppSite.model.BlogInfo.title;b=UppSite.model.BlogInfo.permalink}var a=new Array();a.permalink=b;a.title=c;return a}});Ext.define("UppSite.view.post.IndexPanel",{extend:"Ext.Panel",xtype:"indexpanel",requires:["UppSite.view.post.ExcerptList","UppSite.view.actionsheet.ActionSheet","UppSite.model.BlogInfo"],config:{title:UPPSITE_BLOG_NAME,autoDestroy:false,layout:"vbox",id:"indexpanel",items:[{xtype:"adspanel",flex:1},{xtype:"excerptlist",flex:2}]}});Ext.define("UppSite.view.NavigationExtend",{extend:"Ext.navigation.View",xtype:"navigationextend",requires:["UppSite.view.post.ExcerptList","UppSite.view.post.IndexPanel","UppSite.view.CreateComment","UppSite.view.AdsPanel"],config:{autoDestroy:false,navigationBar:{items:[{xtype:"button",id:"actionButton",iconCls:"action",iconMask:true,hidden:false,align:"right",handler:function(){Ext.ComponentQuery.query("#menu_actionsheet")[0].show()}}],ui:"light"}}});Ext.define("UppSite.view.linklist.Categories",{extend:"UppSite.view.NavigationExtend",xtype:"categoriesview",requires:["UppSite.view.linklist.CategoriesList"],config:{autoDestroy:true,cls:"linkList",title:UPPSITE_BLOG_NAME,items:[{xtype:"categorieslist",flex:2}],listeners:{show:function(){this.parent.down("#actionButton").hide()}}}});Ext.define("UppSite.view.Search.SearchNavigation",{extend:"UppSite.view.NavigationExtend",xtype:"searchnavigation",requires:["UppSite.view.linklist.CategoriesList"],config:{autoDestroy:true,cls:"linkList",title:"Search",items:[{xtype:"searchpanel",flex:2}],listeners:{show:function(){this.parent.down("#actionButton").hide()}}},});Ext.define("UppSite.model.Post",{extend:"Ext.data.Model",config:{fields:["id","permalink","thumb_url","title","time","unix_time","excerpt","content","comments_link","comments_num","comments_open"],belongsTo:[{model:"UppSite.model.Member",name:"member"}],hasMany:[{model:"UppSite.model.Comment",name:"comments"}]}});Ext.define("UppSite.model.Member",{extend:"Ext.data.Model",config:{fields:["id","name","avatar",],}});Ext.define("UppSite.model.Page",{extend:"Ext.data.Model",config:{fields:["permalink","title","content"]}});Ext.define("UppSite.model.Comment",{extend:"Ext.data.Model",config:{fields:["comment_ID","comment_content","comment_author","comment_date"]}});Ext.define("UppSite.model.UserModel",{extend:"Ext.data.Model",config:{fields:["username","userid","publish","logged"]}});Ext.define("UppSite.model.LocalStorge",{statics:{currentTitle:null,currentPermalink:null},constructor:function(a){this.initConfig(a);return this},alias:"model.localstorge"});Ext.define("UppSite.view.Index",{extend:"Ext.navigation.View",xtype:"indexview",requires:["UppSite.view.post.ExcerptList","UppSite.view.post.IndexPanel","UppSite.view.CreateComment"],config:{autoDestroy:false,navigationBar:{items:{xtype:"button",id:"actionButton",iconCls:"action",iconMask:true,hidden:false,align:"right",handler:function(){Ext.ComponentQuery.query("#menu_actionsheet")[0].show()}},ui:"light"},items:[{xtype:"indexpanel"}]}});Ext.define("UppSite.view.NoContentPanel",{extend:"Ext.Container",xtype:"nocontentpanel",requires:[],config:{autoDestroy:false,layout:"fit",centered:true,html:"No Content to display"}});Ext.define("UppSite.store.Posts",{extend:"Ext.data.Store",config:{model:"UppSite.model.Post",storeId:"postsStore",autoLoad:false,pageSize:10,proxy:{type:"ajax",url:"?uppsite_request=index&view=",pageParam:"paged",reader:{type:"json",rootProperty:"root",totalProperty:"total_count"}}},initWithPermalink:function(b){var a=b+"?";if(b.indexOf("?")!=-1){a=b+"&"}this.getProxy().setUrl(a+"uppsite_request=1")},initWithId:function(a){this.getProxy().setUrl("?p="+a+"&uppsite_request=1")},initWithViewParams:function(b){var a=this.getProxy().getUrl();this.getProxy().setUrl(a+b)}});Ext.define("UppSite.store.Pages",{extend:"Ext.data.Store",config:{model:"UppSite.model.Page",autoLoad:true,proxy:{type:"ajax",url:"?uppsite_request=pages"}}});Ext.define("UppSite.store.User",{extend:"Ext.data.Store",requires:["UppSite.model.UserModel"],config:{model:"UppSite.model.UserModel",proxy:{type:"ajax",url:"wp-login.php?uppsite_request=user_details",reader:{type:"json"}}}});Ext.define("UppSite.view.post.PostsList",{extend:"Ext.List",xtype:"postslist",config:{title:"",permalink:"",layout:"vbox",ui:"round",cls:"x-posts-title linkList",allowDeselect:true,autoDestroy:false,items:[{xtype:"adspanel",flex:1}],itemTpl:new Ext.XTemplate('<div class="info">','<div class="author">{member.name}</div>','<div class="title">{title}</div>','<div class="comments">{comments_num} Comments</div>',"</div>",'<tpl if="thumb_url">','<div class="post_thumb"><img src="{thumb_url}" border="0"/></div></tpl>'),listeners:{show:function(){this.parent.parent.down("#actionButton").show();UppSite.model.LocalStorge.currentPermalink=this.getPermalink();UppSite.model.LocalStorge.currentTitle=this.getTitle()},painted:function(){Analytics.startPageEnter("posts-by-tag")}}},add_webbap_get_parm:function(b){var a=b+"?";if(b.indexOf("?")!=-1){a=b+"&"}return a+"uppsite_request=1"},updateRecord:function(a){if(a){var c=Ext.create("UppSite.store.Posts");this.setPermalink(a.data.permalink);this.setTitle(a.data.title);var b=this.add_webbap_get_parm(a.data.permalink);c.initWithPermalink(b);c.load(function(e,d,f){this.setStore(c)},this)}}});Ext.define("UppSite.view.post.PostsListCategories",{extend:"Ext.List",xtype:"postslistcategory",requires:["UppSite.view.post.PostsList"],initialize:function(){this.callParent()},config:{title:"",permalink:"",ui:"round",cls:"x-posts-title linkList",allowDeselect:true,autoDestroy:false,items:[{xtype:"adspanel",flex:1}],itemTpl:new Ext.XTemplate('<div class="info">','<div class="author">{member.name}</div>','<div class="title">{title}</div>','<div class="comments">{comments_num} Comments</div>',"</div>",'<tpl if="thumb_url">','<div class="post_thumb"><img src="{thumb_url}" border="0"/></div></tpl>'),listeners:{show:function(){this.parent.down("#actionButton").show();UppSite.model.LocalStorge.currentPermalink=this.getPermalink();UppSite.model.LocalStorge.currentTitle=this.getTitle()},painted:function(a){Analytics.startPageEnter("posts_by_category_"+this.getTitle())}}},add_webbap_get_parm:function(b){var a=b+"?";if(b.indexOf("?")!=-1){a=b+"&"}return a+"uppsite_request=1"},updateRecord:function(a){if(a){var c=Ext.create("UppSite.store.Posts");var b=this.add_webbap_get_parm(a.data.permalink);this.setPermalink(a.data.permalink);this.setTitle(a.data.title);c.initWithPermalink(b);c.load(function(e,d,f){this.setStore(c)},this)}}});Ext.define("UppSite.view.post.PostsListTags",{extend:"Ext.List",xtype:"postslisttag",requires:["UppSite.view.post.PostsList"],initialize:function(){this.callParent()},config:{title:"",permalink:"",ui:"round",cls:"x-posts-title linkList",allowDeselect:true,autoDestroy:false,items:[{xtype:"adspanel",flex:1}],itemTpl:new Ext.XTemplate('<div class="info">','<div class="author">{member.name}</div>','<div class="title">{title}</div>','<div class="comments">{comments_num} Comments</div>',"</div>",'<tpl if="thumb_url">','<div class="post_thumb"><img src="{thumb_url}" border="0"/></div></tpl>'),listeners:{show:function(){this.parent.down("#actionButton").show();UppSite.model.LocalStorge.currentPermalink=this.getPermalink();UppSite.model.LocalStorge.currentTitle=this.getTitle()},painted:function(a){Analytics.startPageEnter("posts_by_tag_"+this.getTitle())}}},add_webbap_get_parm:function(b){var a=b+"?";if(b.indexOf("?")!=-1){a=b+"&"}return a+"uppsite_request=1"},updateRecord:function(a){if(a){var c=Ext.create("UppSite.store.Posts");var b=this.add_webbap_get_parm(a.data.permalink);this.setPermalink(a.data.permalink);this.setTitle(a.data.title);c.initWithPermalink(b);c.load(function(e,d,f){this.setStore(c)},this)}}});Ext.define("UppSite.view.linklist.PageList",{extend:"UppSite.view.linklist.LinkList",xtype:"pagelist",config:{storeClass:"UppSite.store.Pages",cls:"linkList",listeners:{painted:function(){Analytics.startPageEnter("pages")}}}});Ext.define("UppSite.view.Search.SearchList",{extend:"Ext.List",xtype:"searchlist",requires:["UppSite.view.post.PostsList"],initialize:function(){this.callParent()},config:{title:"",permalink:"",ui:"round",cls:"x-posts-title linkList",allowDeselect:true,autoDestroy:false,itemTpl:new Ext.XTemplate('<div class="info">','<div class="author">{member.name}</div>','<div class="title">{title}</div>','<div class="comments">{comments_num} Comments</div>',"</div>",'<tpl if="thumb_url">','<div class="post_thumb"><img src="{thumb_url}" border="0"/></div></tpl>'),listeners:{show:function(){this.parent.down("#actionButton").show();UppSite.model.LocalStorge.currentPermalink=this.getPermalink();UppSite.model.LocalStorge.currentTitle=this.getTitle()}}},add_webbap_get_parm:function(b){var a=b+"?";if(b.indexOf("?")!=-1){a=b+"&"}return a+"uppsite_request=1"},updateRecord:function(a){if(a){var c=Ext.create("UppSite.store.Posts");var b=this.add_webbap_get_parm(a.data.permalink);c.initWithPermalink(b);c.load(function(e,d,f){this.setStore(c)},this)}}});Ext.define("UppSite.store.Comment",{extend:"Ext.data.Store",config:{model:"UppSite.model.Comment",autoLoad:true,proxy:{type:"memory"}}});Ext.define("UppSite.view.more.About",{extend:"Ext.Panel",config:{fullscreen:true,layout:"fit",cls:"about-panel",listeners:{painted:function(){Analytics.startPageEnter("about")}}}});Ext.define("UppSite.store.Archive",{extend:"UppSite.store.LinkList",config:{proxy:{url:"?uppsite_request=archive"}}});Ext.define("UppSite.store.Tags",{extend:"UppSite.store.LinkList",config:{proxy:{url:"?uppsite_request=tags"}}});Ext.define("UppSite.model.User",{requires:["UppSite.store.User"],statics:{username:null,userid:null,canPublish:false},constructor:function(a){this.initConfig(a);return this},alias:"model.user",statics:{isUserLogged:function(){var a=Ext.create("UppSite.store.User");a.load({callback:function(){var b=a.first();if(!b.data.logged){UppSite.model.User.logout()}else{UppSite.model.User.userid=b.data.userid;UppSite.model.User.username=b.data.username;UppSite.model.User.canPublish=b.data.publish}}});if(UppSite.model.User.username!=null){return true}return false},logout:function(){UppSite.model.User.userid=null;UppSite.model.User.username=null;UppSite.model.User.canPublish=false;Ext.Ajax.request({url:"wp-login.php?uppsite_request=logout",callback:function(a){UppSite.model.User.userid=null;UppSite.model.User.username=null;UppSite.model.User.canPublish=false}})}}});Ext.define("UppSite.controller.MoreTable",{extend:"Ext.app.Controller",requires:["UppSite.view.post.PostsList"],config:{refs:{morenav:"morenavigation",more:"morelist",postslist:"postslists"},control:{morenav:{pop:"onMainPop"},more:{itemsingletap:"onMoreSelect",doubletap:"nothing"}}},onMoreSelect:function(d,b,c,a){if(this.postslist){this.postslist.destroy()}if(UppSite.model.User.isUserLogged()&&b==0){UppSite.model.User.logout();Ext.Msg.alert("Login","Logout succeeded",Ext.emptyFn);this.getMore().switchToLogout()}else{var d=Ext.create(a.data.view);this.getMorenav().push(d)}Analytics.logTabChange(a.raw.title)},nothing:function(){},onMainPop:function(a,b){this.getMore().switchToLogin();this.getMore().deselectAll(false)}});Ext.define("UppSite.view.post.PagesPanel",{extend:"UppSite.view.NavigationExtend",xtype:"pagespanel",requires:["UppSite.view.linklist.PageList"],config:{autoDestroy:true,title:UPPSITE_BLOG_NAME,items:[{xtype:"pagelist",title:"Pages",flex:2}]}});Ext.define("UppSite.view.Pages",{extend:"UppSite.view.NavigationExtend",xtype:"pagesview",requires:["UppSite.view.post.PagesPanel"],config:{autoDestroy:true,cls:"linkList",items:[{xtype:"pagespanel"}],listeners:{painted:function(){Analytics.startPageEnter("pages")}}}});Ext.define("UppSite.controller.LinkList",{extend:"Ext.app.Controller",requires:["UppSite.view.post.PostsList"],config:{refs:{main:"morenavigation",linklist:"",postslist:"postslists"},control:{main:{pop:"onMainPop"},linklist:{itemtap:"onItemSelect",doubletap:"nothing"}}},onItemSelect:function(d,b,c,a){if(this.postslist){this.postslist.destroy()}var d=Ext.create("UppSite.view.post.PostsList",{title:UPPSITE_BLOG_NAME});d.setRecord(a);this.getMain().push(d)},nothing:function(){},onMainPop:function(a,b){if(this.getLinklist()!=undefined){this.getLinklist().deselectAll(false)}}});Ext.define("UppSite.controller.Categories",{extend:"UppSite.controller.LinkList",requires:["UppSite.view.post.PostsList","UppSite.view.post.PostsListCategories"],views:["PostsListCategories"],config:{refs:{main:"categoriesview",linklist:"categorieslist"}},onItemSelect:function(d,b,c,a){if(this.postslist){this.postslist.destroy()}var d=Ext.create("UppSite.view.post.PostsListCategories",{title:a.raw.title});d.setRecord(a);this.getMain().push(d)},onMainPop:function(a,b){if(this.getLinklist()!=undefined){this.getLinklist().deselectAll(false)}}});Ext.define("UppSite.controller.Archive",{extend:"UppSite.controller.LinkList",requires:["UppSite.view.post.PostsList"],views:["Archive"],config:{refs:{linklist:"archivelist"}}});Ext.define("UppSite.controller.Tags",{extend:"UppSite.controller.LinkList",requires:["UppSite.view.post.PostsList","UppSite.view.post.PostsListTags"],views:["PostsListTags"],config:{refs:{main:"morenavigation",linklist:"tagslist"}},onItemSelect:function(d,b,c,a){if(this.postslist){this.postslist.destroy()}var d=Ext.create("UppSite.view.post.PostsListTags",{title:a.raw.title});d.setRecord(a);this.getMain().push(d)},onMainPop:function(a,b){if(this.getLinklist()!=undefined){this.getLinklist().deselectAll(false)}}});Ext.define("UppSite.view.Comment",{extend:"Ext.List",xtype:"commentlist",requires:["UppSite.store.Comment"],config:{scrollable:false,ui:"round",allowDeselect:true,onItemTouchStart:null,itemTpl:['<header class="comment-header">','<div class="alignleft thumb-box">','<div class="author-thumbnail" style="background-image: url({comment_author.avatar})"></div></div>','<div class="alignleft comment-info">','<div class="author-name">{comment_author.name}</div>','<div class="info"><span class="time">{comment_date}</span></div></div>',"</header>",'<div class="comment-content">{comment_content}</div>'].join("")}});Ext.define("UppSite.view.Search.Search",{extend:"Ext.form.Panel",xtype:"searchpanel",requires:["UppSite.view.Comment","UppSite.view.Search.SearchBar","UppSite.view.Search.SearchList"],config:{title:"Search",layout:"fit",items:[{xtype:"adspanel",flex:1},{docked:"top",xtype:"searchbar",listeners:{painted:function(){Analytics.startPageEnter("search")}}}]},search:function(c){var b=Ext.create("UppSite.view.Search.SearchList");var a=Ext.create("UppSite.model.LinkList");a.data.permalink="?s="+c;b.setRecord(a);this.add(b);Analytics.logSearch(c)}});Ext.define("UppSite.view.CommentPanel",{extend:"Ext.Panel",xtype:"commentpanel",requires:["UppSite.view.Comment"],config:{title:"comment List",autoDestroy:false,layout:"vbox",items:[{id:"commentsTop",html:['<div id="comments-top"><a name="comments-top">&nbsp;</a></div>'].join("")},{xtype:"commentlist",id:"commentsList"}],listeners:{show:function(){}}},updatePostId:function(b){var a=Ext.create("UppSite.store.Comment");a.initProxy(b);a.load();this.down("#commentsList").setStore(a)},updateComments:function(b){if(b.length==0){this.destroy()}else{var a=Ext.create("UppSite.store.Comment",{data:b});this.down("#commentsList").setStore(a);this.down("#commentsTop").setHtml('<div id="comments-top">Comments ('+b.length+")</div>");Ext.get("commentsTop").child("div.x-inner",true).className+=" topArrow"}}});Ext.define("UppSite.view.post.Full",{extend:"Ext.Panel",xtype:"post-full",requires:["UppSite.view.CommentPanel","UppSite.view.CreateComment"],config:{baseCls:"x-post-full",layout:"vbox",scrollable:"vertical",id:"fullpostview",ui:"round",visible:true,items:[{xtype:"adspanel",flex:1},{id:"surrounding",items:[{id:"content_fullpostview",tpl:new Ext.XTemplate("<header>",'<div class="post-header">','<tpl if="thumb_url"><div class="img-wrapper"><img src="{thumb_url}" /></div></tpl>','<span id="post-title">{title}</span>',"</div>",'<div class="info"><span class="time">{time}</span><span class="sep">|</span><span class="author">{member.name}</span></div>','<tpl if="comments.length &gt; 0"><div id="skiptocomments"><div id="skiptocomments-text">Skip to comments</div></div></tpl>',"</header>",'<div class="post-content">{content}</div>','<tpl if="comments_open">',"<footer>",'<div id="addcomment"><span>Add Comment</span></div>','<input type="hidden" id="post_permalink" value="{permalink}" />',"</footer>","</tpl>")},{id:"comments",xtype:"commentpanel"}]}],record:null,listeners:{show:function(){UppSite.model.LocalStorge.currentPermalink=this.getRecord().data.permalink;UppSite.model.LocalStorge.currentTitle=this.getRecord().data.title;this.applyAddCommentAction(6);this.applySkipToComments(6);this.applyWidthChanges(6)},painted:function(){Analytics.startPageEnter(this.getRecord().data.permalink)}}},applyWidthChanges:function(b){if(b==0){return}MAGIC_MAX_WIDTH=(WINDOW_WIDTH-40);var a=this;Ext.defer(function(){var c=["iframe","object","embed","param"];for(var f in c){var g=Ext.query("#content_fullpostview "+c[f]);for(var d in g){var e=g[d];var h=e.width;if(h==undefined||h<=MAGIC_MAX_WIDTH){e.src=e.src;continue}if(e.height!=undefined){newHeight=e.height*(MAGIC_MAX_WIDTH/h);e.height=newHeight}e.width=MAGIC_MAX_WIDTH;e.src=e.src}}a.applyWidthChanges(b-1)},500)},applySkipToComments:function(a){if(a<0){return}var b=this;Ext.defer(function(){var c=Ext.DomQuery.selectNode("#skiptocomments");if(!c){b.applySkipToComments(a-1);return}Ext.get(c).on("tap",function(d){b.getScrollable().getScroller().scrollTo(0,Ext.DomQuery.selectNode("#comments").offsetTop,true)})},500)},applyAddCommentAction:function(a){if(a<0){Ext.ComponentQuery.query("#actionsheet_comment_button")[0].hide();return}var b=this;Ext.defer(function(){var c=Ext.DomQuery.selectNode("#addcomment");if(!c){b.applyAddCommentAction(a-1);return}Ext.ComponentQuery.query("#actionsheet_comment_button")[0].show();Ext.get(c).on("touchstart",function(d){Ext.DomQuery.selectNode("#addcomment").className="pressed"});Ext.get(c).on("touchend",function(d){Ext.ComponentQuery.query("#actionsheet_comment_button")[0]._handler();Ext.DomQuery.selectNode("#addcomment").className=""})},500)},showAction:function(){var a=Ext.ComponentQuery.query("#actionButton")},updateRecord:function(a){if(a){var b=Ext.create("UppSite.store.Posts");b.initWithPermalink(a.data.permalink);b.sync();b.load(function(e,d,h){this.down("#content_fullpostview").setData(b.first().raw);this.down("#content_fullpostview").config.permalink=b.first().raw.permalink;Ext.get("content_fullpostview").child("div.x-inner",true).className+=" fullpostviewStyle";var g=Ext.DomQuery.select(".post-content a");var c=g.length;for(var f=0;f<c;f++){g[f].onclick=function(j){j.preventDefault();if((this.href.indexOf(UPPSITE_BLOG_URL)!=0)&&(this.href.indexOf("://")!=-1)){Analytics.logExternalLink(this.href)}window.open(this.href,"")}}this.down("#comments").updateComments(b.first().raw.comments)},this)}Ext.ComponentQuery.query("#actionButton")[0].show();this.showActionButton()},showActionButton:function(){var a=Ext.ComponentQuery.query("tabpanel")[0]}});Ext.define("UppSite.controller.Posts",{extend:"Ext.app.Controller",requires:["UppSite.view.post.Full"],config:{id:"PostsController",refs:{main:"indexview",posts:"excerptlist",showPost:"post-full"},control:{main:{pop:"onMainPop"},posts:{itemsingletap:"onPostSelect",itemdoubletap:"nothing"}}},onPostSelect:function(d,b,c,a){if(this.showPost){this.showPost.destroy()}this.showPost=Ext.create("UppSite.view.post.Full");this.showPost.setRecord(a);this.showPost.config.title=UPPSITE_BLOG_NAME;this.getMain().push(this.showPost)},nothing:function(){},onMainPop:function(a,b){if(b.xtype=="post-full"&&this.getPosts()!=undefined){this.getPosts().deselectAll(false);Ext.ComponentQuery.query("#actionsheet_comment_button")[0].hide()}}});Ext.define("UppSite.controller.Pages",{extend:"Ext.app.Controller",requires:["UppSite.view.post.Full"],config:{refs:{main:"pagespanel",posts:"pagelist",showPost:"post-full"},control:{main:{pop:"onMainPop"},posts:{itemtap:"onPostSelect",doubletap:"nothing"}}},onPostSelect:function(d,b,c,a){if(this.showPost){this.showPost.destroy()}this.getMain().down("#actionButton").show();this.showPost=Ext.create("UppSite.view.post.Full");this.showPost.setRecord(a);this.showPost.config.title=a.raw.title;this.getMain().push(this.showPost)},nothing:function(){},onMainPop:function(a,b){if(b.xtype=="post-full"){this.getPosts().deselectAll(false)}}});Ext.define("UppSite.controller.PostsList",{extend:"UppSite.controller.Posts",requires:["UppSite.view.post.Full"],config:{id:"PostsListController",refs:{main:"morenavigation",posts:"postslist"}}});Ext.define("UppSite.controller.PostsListCategories",{extend:"UppSite.controller.PostsList",views:["UppSite.view.post.PostsListCategories"],config:{id:"PostsListCategoriesController",refs:{main:"categoriesview",posts:"postslistcategory"}},onPostSelect:function(d,b,c,a){if(this.showPost){this.showPost.destroy()}this.showPost=Ext.create("UppSite.view.post.Full");this.showPost.setRecord(a);this.showPost.config.title=UPPSITE_BLOG_NAME;this.getMain().push(this.showPost)},onMainPop:function(a,b){if(b.xtype=="post-full"){if(this.getPosts()!=undefined){this.getPosts().deselectAll(false)}Ext.ComponentQuery.query("#actionsheet_comment_button")[0].hide()}}});Ext.define("UppSite.controller.PostsListTags",{extend:"UppSite.controller.PostsList",views:["UppSite.view.post.PostsListTags"],config:{id:"PostsListTagsController",refs:{main:"morenavigation",posts:"postslisttag"}},onPostSelect:function(d,b,c,a){if(this.showPost){this.showPost.destroy()}console.log("A");this.showPost=Ext.create("UppSite.view.post.Full");this.showPost.setRecord(a);this.showPost.config.title=UPPSITE_BLOG_NAME;this.getMain().push(this.showPost)},onMainPop:function(a,b){if(b.xtype=="post-full"){if(this.getPosts()!=undefined){this.getPosts().deselectAll(false)}Ext.ComponentQuery.query("#actionsheet_comment_button")[0].hide()}}});Ext.define("UppSite.controller.SearchList",{extend:"UppSite.controller.PostsList",config:{id:"PostsListCategoriesController",refs:{main:"searchnavigation",posts:"searchlist"}},onPostSelect:function(d,b,c,a){if(this.showPost){this.showPost.destroy()}this.showPost=Ext.create("UppSite.view.post.Full");this.showPost.setRecord(a);this.showPost.config.title=a.raw.title;this.getMain().showNavigationBar();this.getMain().push(this.showPost)},onMainPop:function(a,b){if(b.xtype=="post-full"){this.getMain().hideNavigationBar();this.getPosts().deselectAll(false);Ext.ComponentQuery.query("#actionsheet_comment_button")[0].hide()}}});Ext.define("UppSite.controller.PostsLink",{extend:"Ext.app.Controller",requires:["UppSite.view.post.Full"],config:{id:"PostLinkController",refs:{main:"indexview",posts:"excerptlist",showPost:"post-full"},routes:{"post/:id":"postSelect"}},postSelect:function(c){var b=Ext.create("UppSite.store.Posts");b.initWithId(c);var a;b.load(function(f,e,g){var d=f[0];this.showPost=Ext.create("UppSite.view.post.Full");this.showPost.setRecord(d);this.showPost.config.title=d.raw.title;this.getMain().push(this.showPost)},this)}});Ext.define("UppSite.view.Login.Login",{extend:"Ext.form.Panel",xtype:"loginform",requires:["Ext.form.FieldSet","Ext.form.Email","Ext.form.Url","UppSite.model.User","UppSite.store.User"],initialize:function(){Ext.ComponentQuery.query("#morenavigationView")[0].getNavigationBar().hide();this.callParent()},config:{id:"loginView",items:[{title:"Login",xtype:"toolbar",ui:"light",docked:"top",layout:{pack:"start"},items:[{xtype:"button",text:"Cancel",align:"left",handler:function(){Ext.ComponentQuery.query("#morenavigationView")[0].getNavigationBar().show();this.up("morenavigation").pop()}},{xtype:"spacer"},{xtype:"button",text:"Login",align:"right",handler:function(){this.up("loginform").submit({url:"wp-login.php?uppsite_request=1",method:"POST",success:function(b,a){this.login(a)},failure:function(b,a){Ext.Msg.alert("Login","Bad Username or Password",Ext.emptyFn)}})}}]},{xtype:"fieldset",items:[{xtype:"textfield",name:"log",label:"Username",labelWidth:100},{xtype:"passwordfield",name:"pwd",label:"Password",labelWidth:100}]}],listeners:{painted:function(){Analytics.startPageEnter("login")}}},login:function(a){UppSite.model.User.username=a.username;UppSite.model.User.userid=a.userid;UppSite.model.User.canPublish=a.publish;Ext.Msg.alert("Login","Login succeeded",Ext.emptyFn);Ext.ComponentQuery.query("#morenavigationView")[0].getNavigationBar().show();Ext.ComponentQuery.query("#morenavigationView")[0].pop();Analytics.logLogin(a.username)}});Ext.define("UppSite.view.linklist.Archive",{extend:"UppSite.view.linklist.LinkList",xtype:"archivelist",requires:["UppSite.store.Archive"],config:{ui:"round",cls:"x-cats linkList",storeClass:"UppSite.store.Archive",title:UPPSITE_BLOG_NAME,listeners:{painted:function(){Analytics.startPageEnter("archive")}}}});Ext.define("UppSite.view.linklist.Tags",{extend:"UppSite.view.linklist.LinkList",xtype:"tagslist",requires:["UppSite.store.Tags"],config:{ui:"round",cls:"x-cats linkList",storeClass:"UppSite.store.Tags",title:UPPSITE_BLOG_NAME,listeners:{painted:function(){Analytics.startPageEnter("tags")}}}});Ext.define("UppSite.view.more.MoreTable",{extend:"Ext.List",xtype:"morelist",requires:["UppSite.view.Login.Login","UppSite.view.linklist.Archive","UppSite.view.linklist.Tags","UppSite.view.more.About"],initialize:function(){this.callParent()},config:{id:"moretableView",data:[{title:"Login",view:"UppSite.view.Login.Login"},{title:"Archive",view:"UppSite.view.linklist.Archive"},{title:"Tags",view:"UppSite.view.linklist.Tags"},{title:"About",view:"UppSite.view.more.About"}],title:UPPSITE_BLOG_NAME,allowDeselect:true,itemTpl:['<div class="iconed-item-icon icon-{title}"></div><div class="iconed-item-title" id="{title}_sp">{title}</div>'].join(""),onItemDisclosure:true,listeners:{show:function(){this.parent.down("#actionButton").hide()}}},switchToLogin:function(){if(UppSite.model.User.isUserLogged()){Ext.select("#Login_sp").elements[0].innerHTML="Logout";var a=this.getData();a[0].title="Logout";a[0].view="UppSite.view.Login.Logout";if(UppSite.model.User.canPublish&&this.getStore().getAt(4)==undefined){this.getStore().add({title:"NewPost",view:"UppSite.view.newpost.NewPost"})}}},switchToLogout:function(){Ext.select("#Login_sp").elements[0].innerHTML="Login";var a=this.getData();a[0].title="Login";a[0].view="UppSite.view.Login.Login";this.getStore().removeAt(4);this.getStore().sync()}});Ext.define("UppSite.view.more.MoreNavigation.js",{extend:"UppSite.view.NavigationExtend",xtype:"morenavigation",requires:["UppSite.view.more.MoreTable"],config:{id:"morenavigationView",autoDestroy:true,title:"More",items:[{xtype:"morelist",listeners:{painted:function(){Analytics.startPageEnter("more")}}}]}});Ext.define("UppSite.view.MainTabBar",{extend:"Ext.TabPanel",requires:["Ext.TitleBar","Ext.navigation.View","UppSite.view.linklist.Categories","UppSite.view.Search.Search","UppSite.view.more.MoreNavigation","UppSite.view.Search.SearchNavigation"],xtype:"maintabarpanel",config:{id:"tabbarMainPanel",tabBar:{docked:"bottom",ui:"neutral",layout:{pack:"center"}},layout:{animation:{type:"fade",duration:0.1,easing:"linear",useCssTransform:false}},items:[{title:"Home",iconCls:"home",layout:"fit",items:[{xtype:"indexview"}]},{title:"Pages",iconCls:"pages",layout:"fit",items:[{xtype:"pagespanel"}]},{title:"Categories",iconCls:"categories",layout:"fit",items:[{xtype:"categoriesview"}]},{title:"Search",iconCls:"search",layout:"fit",items:[{xtype:"searchnavigation"}]},{title:"More",iconCls:"more",layout:"fit",items:[{xtype:"morenavigation"}]}]}});Ext.define("UppSite.view.MainPanel",{extend:"Ext.Panel",xtype:"mainpanel",requires:["UppSite.view.MainTabBar","UppSite.view.actionsheet.ActionSheet"],config:{autoDestroy:false,fullscreen:true,id:"mainpanel",layout:"fit",items:[{xtype:"maintabarpanel"},{xtype:"actionsheet"},]}});Ext.define("UppSite.controller.MainTabBar",{extend:"Ext.app.Controller",requires:["UppSite.view.MainTabBar"],views:["UppSite.view.MainTabBar"],config:{refs:{tab:"#tabbarMainPanel",more:"morelist"},control:{tab:{activeitemchange:"onSwitchTab"}}},onSwitchTab:function(c,b,d){var a=Ext.ComponentQuery.query("navigationview");for(i=0;i<a.length;i++){a[i].reset()}if(b.tab.getText()=="More"){this.getMore().switchToLogin()}Analytics.logTabChange(b.tab.getText())}});Ext.application({name:"UppSite",requires:["Ext.MessageBox","UppSite.view.linklist.Categories","UppSite.model.LinkList","UppSite.view.Search.SearchBar","UppSite.view.Search.SearchNavigation","UppSite.helper.Analytics"],controllers:["Posts","Pages","Categories","MoreTable","Archive","PostsList","Tags","PostsListCategories","PostsListTags","UppSite.controller.SearchList","UppSite.controller.MainTabBar","UppSite.controller.PostsLink"],models:["Post","Member","Page","Comment","User","UserModel","BlogInfo","LocalStorge"],stores:["Posts","Pages","LinkList"],views:["Index","Pages","MainPanel","UppSite.view.Search.SearchBar","UppSite.view.Search.SearchNavigation","AdsPanel","NoContentPanel"],icon:{57:"http://img.upp.st/icon/"+UPPSITE_APP_ID+".png",72:"http://img.upp.st/icon/"+UPPSITE_APP_ID+"-72.png",114:"http://img.upp.st/icon/"+UPPSITE_APP_ID+"@2x.png",144:"http://img.upp.st/icon/"+UPPSITE_APP_ID+"-144.png"},phoneStartupScreen:"http://img.upp.st/startup/"+UPPSITE_APP_ID+".png",tabletStartupScreen:"http://img.upp.st/startup_tablet/"+UPPSITE_APP_ID+".png",statusBarStyle:"black",launch:function(){Ext.fly("appLoadingIndicator").destroy();UppSite.model.User.isUserLogged();Ext.Viewport.add(Ext.create("UppSite.view.MainPanel"));Ext.create("UppSite.model.BlogInfo");WINDOW_WIDTH=Ext.getBody().getWidth();WINDOW_HEIGHT=Ext.getBody().getHeight()},viewport:{autoMaximize:true},onUpdated:function(){Ext.Msg.confirm("Application Update","This application has just successfully been updated to the latest version. Reload now?",function(){window.location.reload()})}});